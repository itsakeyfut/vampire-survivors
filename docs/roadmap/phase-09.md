# Phase 9: 敵バリエーション

## フェーズ概要

**ステータス**: 🔲 未着手
**推定工数**: 4-6時間
**依存関係**: Phase 5

### 目的
残り5種の敵（ゾンビ・ゴースト・デーモン・メデューサ・ドラゴン）を実装し、各敵が固有のAIで動作する状態にする。

---

## タスクリスト

### タスク 9.1: ゾンビ（Zombie）の実装

**優先度**: P0
**推定工数**: 0.5時間
**ラベル**: task, phase-9

**説明**:
ゾンビは低速だがHPが高く、近づくと高ダメージを与える敵。基本AIは `ChasePlayer`。

**受け入れ基準**:
- [ ] HP: 60（難易度倍率適用）、速度: 60、ダメージ: 12
- [ ] 5分以降にスポーンテーブルに追加される
- [ ] プレースホルダースプライト（くすんだ緑色）

---

### タスク 9.2: ゴースト（Ghost）の実装

**優先度**: P0
**推定工数**: 1時間
**ラベル**: task, phase-9

**説明**:
ゴーストは壁（地形）をすり抜け、プレイヤーを直線的に追跡する敵。「壁をすり抜ける」は無限マップなので特別な処理は不要だが、他の敵との衝突を無視することで実現。

**受け入れ基準**:
- [ ] HP: 25、速度: 100、ダメージ: 10
- [ ] 10分以降にスポーンテーブルに追加される
- [ ] プレースホルダースプライト（半透明の白/青）
- [ ] 他の敵エンティティとの衝突判定を持たない（すり抜ける）

---

### タスク 9.3: デーモン（Demon）の実装

**優先度**: P0
**推定工数**: 0.5時間
**ラベル**: task, phase-9

**説明**:
デーモンは高速でプレイヤーを追跡する強力な敵。AIは `ChasePlayer`（速め）。

**受け入れ基準**:
- [ ] HP: 80（難易度倍率適用）、速度: 130、ダメージ: 15
- [ ] 15分以降にスポーンテーブルに追加される

---

### タスク 9.4: メデューサ（Medusa）の実装

**優先度**: P0
**推定工数**: 1.5時間
**ラベル**: task, phase-9

**説明**:
メデューサはプレイヤーから一定距離を保ちながら、遠距離攻撃（石化弾）を発射する敵。`KeepDistance` AIタイプ。

**受け入れ基準**:
- [ ] プレイヤーから150〜250pxの距離を保つAIが実装されている
- [ ] 2秒ごとにプレイヤーに向けて投射体（石化弾）を発射する
- [ ] 投射体がプレイヤーに当たるとダメージを与える

**実装ガイド**:
```rust
pub fn update_keep_distance_ai(
    player_query: Query<&Transform, With<Player>>,
    mut enemy_query: Query<(&mut Transform, &Enemy, &EnemyAI)>,
    time: Res<Time>,
) {
    let Ok(player_t) = player_query.get_single() else { return };
    let player_pos = player_t.translation.truncate();

    for (mut transform, enemy, ai) in enemy_query.iter_mut() {
        if ai.ai_type != AIType::KeepDistance { continue; }
        let enemy_pos = transform.translation.truncate();
        let dist = enemy_pos.distance(player_pos);
        let preferred_dist = 200.0;

        let direction = if dist < preferred_dist - 30.0 {
            // 近すぎる: プレイヤーから離れる
            (enemy_pos - player_pos).normalize_or_zero()
        } else if dist > preferred_dist + 30.0 {
            // 遠すぎる: プレイヤーに近づく
            (player_pos - enemy_pos).normalize_or_zero()
        } else {
            Vec2::ZERO
        };

        transform.translation += (direction * enemy.move_speed * time.delta_secs()).extend(0.0);
    }
}
```

---

### タスク 9.5: ドラゴン（Dragon）の実装

**優先度**: P0
**推定工数**: 1.5時間
**ラベル**: task, phase-9

**説明**:
ドラゴンは比較的大型の敵で、プレイヤー方向に火球を発射する。移動はプレイヤー追跡。

**受け入れ基準**:
- [ ] HP: 150、速度: 90、ダメージ（接触）: 25
- [ ] 3秒ごとにプレイヤー方向に火球（投射体）を発射する
- [ ] 火球がプレイヤーに当たるとダメージ
- [ ] 25分以降にスポーンテーブルに追加される

---

### タスク 9.6: スポーンテーブルの更新

**優先度**: P0
**推定工数**: 0.5時間
**ラベル**: task, phase-9

**説明**:
全7種の敵が時間帯に応じて正しく出現するようスポーンテーブルを更新する。

**受け入れ基準**:
- [ ] 各敵タイプが設計書の出現開始時刻から出現する
- [ ] 時間が経つほど強い敵タイプが増える（出現確率のウェイト調整）

---

## フェーズ検証

### 検証項目
- [ ] 5分後にゾンビが出現する
- [ ] 10分後にゴーストが出現する（素通りのような挙動）
- [ ] 15分後にデーモンが高速で追ってくる
- [ ] 20分後にメデューサが遠距離攻撃してくる
- [ ] 25分後にドラゴンが火球を吐く
- [ ] 各敵のHP・速度・ダメージが設計書通り

## 次のフェーズ

Phase 9 完了 → 次は **Phase 10: ボスシステム** に進む
